<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GCash Agent Logbook Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
:root { 
    --primary: #007bff; --success: #28a745; --danger: #dc3545; --bg: #f4f6fa; --card: #ffffff; --text: #333333; --border: #eeeeee; --input-bg: #ffffff;
}
body.dark { 
    --bg: #121212; --card: #1e1e1e; --text: #e0e0e0; --border: #333333; --input-bg: #2d2d2d;
}

body { font-family: -apple-system, Arial, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; transition: 0.3s; }
.container { max-width: 950px; margin: auto; background: var(--card); padding: 20px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); }

h1 { text-align: center; color: var(--primary); margin-bottom: 20px; font-size: 22px; }
.theme-toggle { background: none; color: var(--primary); border: 1px solid var(--primary); width: auto; padding: 8px 15px; font-size: 12px; border-radius: 20px; cursor: pointer; display: block; margin: 0 auto 15px auto; }

.dashboard { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
.stat-box { background: var(--bg); padding: 12px 5px; border-radius: 12px; text-align: center; border: 1px solid var(--border); }
.stat-label { font-size: 9px; opacity: 0.7; text-transform: uppercase; font-weight: bold; }
.stat-value { font-size: 13px; font-weight: bold; display: block; margin-top: 4px; }

label { font-weight: 600; margin-top: 15px; display: block; font-size: 13px; }
input, select, button { width: 100%; padding: 12px; margin-top: 6px; border-radius: 10px; border: 1px solid var(--border); font-size: 14px; box-sizing: border-box; background: var(--input-bg); color: var(--text); }
button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }

.quick-btns { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 5px; }
.quick-btns button { background: var(--border); color: var(--text); font-size: 12px; padding: 10px; }

.table-header-tools { margin-top: 30px; }
.search-input { border: 2px solid var(--primary); margin-bottom: 10px; }

.table-container { width: 100%; overflow-x: auto; margin-top: 10px; border-radius: 10px; border: 1px solid var(--border); }
table { width: 100%; border-collapse: collapse; min-width: 750px; }
th, td { border-bottom: 1px solid var(--border); padding: 12px 8px; font-size: 12px; text-align: center; }
th { background: var(--bg); color: var(--primary); }

.del-btn { background: var(--danger); width: auto; padding: 6px 10px; font-size: 10px; }
.csv-btn { background: #6c757d; margin-bottom: 15px; }

.setup-section { margin-top: 40px; padding-top: 20px; border-top: 2px dashed var(--border); }
.setup-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
</style>
</head>
<body>

<div id="mainApp" style="display:none;">
    <div class="container">
        <button class="theme-toggle" onclick="toggleTheme()">üåì Toggle Dark/White Mode</button>
        <h1>üìí GCash Logbook</h1>

        <div class="dashboard">
            <div class="stat-box"><span class="stat-label">GCash</span><span class="stat-value" style="color:var(--primary)">‚Ç±<span id="walletDisp">0</span></span></div>
            <div class="stat-box"><span class="stat-label">On Hand</span><span class="stat-value" style="color:var(--success)">‚Ç±<span id="cashDisp">0</span></span></div>
            <div class="stat-box"><span class="stat-label">Today</span><span class="stat-value" style="color:#6f42c1">‚Ç±<span id="dailyDisp">0</span></span></div>
            <div class="stat-box"><span class="stat-label">Month</span><span class="stat-value" style="color:#fd7e14">‚Ç±<span id="monthlyDisp">0</span></span></div>
        </div>

        <label>Transaction Type</label>
        <select id="type">
            <option value="" disabled selected>Select Type</option>
            <option value="cashin">Cash In</option>
            <option value="load">Load</option>
            <option value="cashout">Cash Out</option>
        </select>

        <label>Customer Name</label>
        <input type="text" id="note" placeholder="Enter Name">

        <label>GCash Number</label>
        <input type="text" id="phoneNumber" placeholder="09xxxxxxxxx">

        <label>Reference Number</label>
        <input type="text" id="refNum" placeholder="Enter Ref #">

        <label>Amount (‚Ç±)</label>
        <div class="quick-btns">
            <button type="button" onclick="setAmount(100)">+100</button>
            <button type="button" onclick="setAmount(500)">+500</button>
            <button type="button" onclick="setAmount(1000)">+1k</button>
        </div>
        <input type="number" id="amount" placeholder="0.00" oninput="autoCalculateTubo()">

        <label>Fee / Tubo (‚Ç±)</label>
        <input type="number" id="charge" placeholder="0.00">

        <button onclick="addTransaction()" style="margin-top: 20px; background: var(--primary); height: 50px;">Save Transaction</button>
        
        <div class="table-header-tools">
            <button onclick="downloadCSV()" class="csv-btn">üì• Download Spreadsheet</button>
            <input type="text" id="search" class="search-input" placeholder="üîç Search name, number, or ref#..." oninput="render()">
        </div>

        <div class="table-container">
            <table>
                <thead><tr><th>Date</th><th>Type</th><th>Ref #</th><th>Name</th><th>Number</th><th>Amt</th><th>Fee</th><th>Action</th></tr></thead>
                <tbody id="logTable"></tbody>
            </table>
        </div>

        <div class="setup-section">
            <h3>‚öôÔ∏è Manual Balance Override</h3>
            <div class="setup-grid">
                <div><label>Set Wallet</label><input type="number" id="startWallet"></div>
                <div><label>Set On Hand</label><input type="number" id="startCash"></div>
                <div><label>Set Today's Tubo</label><input type="number" id="startDaily"></div>
                <div><label>Set Month Tubo</label><input type="number" id="startMonthly"></div>
            </div>
            <button onclick="saveInventory()" style="background:#6c757d; margin-top:15px;">Update Totals</button>
            <button onclick="logout()" style="background:#000; font-size:12px; margin-top:30px;">Lock App</button>
        </div>
    </div>
</div>

<script>
/* SECURITY & THEME */
function checkAuth() {
    let pin = localStorage.getItem("pin");
    let sessionAuth = sessionStorage.getItem("isLoggedIn");
    if (!pin || pin === "null") {
        let newPin = prompt("Set PIN:");
        if (newPin) { localStorage.setItem("pin", newPin); sessionStorage.setItem("isLoggedIn", "true"); showApp(); }
    } else if (sessionAuth === "true") { showApp(); }
    else {
        let enter = prompt("Enter PIN:");
        if (enter === pin) { sessionStorage.setItem("isLoggedIn", "true"); showApp(); }
        else { alert("Wrong PIN"); window.location.reload(); }
    }
}
function showApp() { 
    if(localStorage.getItem("theme") === "dark") document.body.classList.add("dark");
    document.getElementById("mainApp").style.display = "block"; 
    render(); 
}
function toggleTheme() {
    document.body.classList.toggle("dark");
    localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
}

/* CORE LOGIC */
let logs = JSON.parse(localStorage.getItem("gcashLogs")) || [];
let initWallet = Number(localStorage.getItem("initWallet")) || 0;
let initCash = Number(localStorage.getItem("initCash")) || 0;
let initDaily = Number(localStorage.getItem("initDaily")) || 0;
let initMonthly = Number(localStorage.getItem("initMonthly")) || 0;

document.getElementById("startWallet").value = initWallet;
document.getElementById("startCash").value = initCash;
document.getElementById("startDaily").value = initDaily;
document.getElementById("startMonthly").value = initMonthly;

function setAmount(val) { document.getElementById("amount").value = val; autoCalculateTubo(); }

function autoCalculateTubo() {
    const amt = Number(document.getElementById("amount").value);
    const chargeInput = document.getElementById("charge");
    if (amt >= 2501) chargeInput.value = 35;
    else if (amt >= 1001) chargeInput.value = 25;
    else if (amt >= 501) chargeInput.value = 20;
    else if (amt >= 251) chargeInput.value = 15;
    else if (amt >= 1) chargeInput.value = 10;
}

function addTransaction() {
    const type = document.getElementById("type").value;
    const amt = Number(document.getElementById("amount").value);
    const charge = Number(document.getElementById("charge").value) || 0;
    
    if (!type) return alert("Please select Transaction Type");
    if (amt <= 0) return alert("Enter amount");

    const now = new Date();
    logs.push({
        id: Date.now(),
        date: now.toLocaleString([], { month: 'short', day: 'numeric', hour: '2-digit', minute:'2-digit' }),
        day: now.toLocaleDateString(),
        month: now.getMonth() + "-" + now.getFullYear(),
        type: type,
        ref: document.getElementById("refNum").value || "---",
        phone: document.getElementById("phoneNumber").value || "N/A",
        note: document.getElementById("note").value || "-",
        amount: amt,
        charge: charge
    });
    
    // RESET ALL FIELDS TO BLANK
    document.getElementById("type").selectedIndex = 0;
    document.getElementById("refNum").value = "";
    document.getElementById("phoneNumber").value = "";
    document.getElementById("note").value = "";
    document.getElementById("amount").value = "";
    document.getElementById("charge").value = "";
    
    save();
}

function render() {
    const table = document.getElementById("logTable");
    const query = document.getElementById("search").value.toLowerCase();
    let currentWallet = initWallet;
    let currentCash = initCash;
    let dailyTubo = initDaily;
    let monthlyTubo = initMonthly;
    
    const today = new Date().toLocaleDateString();
    const thisMonth = new Date().getMonth() + "-" + new Date().getFullYear();
    
    table.innerHTML = "";
    logs.forEach(l => {
        if (l.type === "cashin" || l.type === "load") {
            currentWallet -= l.amount;
            currentCash += (l.amount + l.charge);
        } else if (l.type === "cashout") {
            currentWallet += (l.amount + l.charge);
            currentCash -= l.amount;
        }
        
        if (l.day === today) dailyTubo += l.charge;
        if (l.month === thisMonth) monthlyTubo += l.charge;
        
        if (l.note.toLowerCase().includes(query) || l.phone.includes(query) || l.ref.toLowerCase().includes(query)) {
            table.innerHTML = `<tr>
                <td>${l.date}</td>
                <td><b>${l.type.toUpperCase()}</b></td>
                <td>${l.ref}</td>
                <td>${l.note}</td>
                <td>${l.phone}</td>
                <td>‚Ç±${l.amount.toLocaleString()}</td>
                <td>‚Ç±${l.charge}</td>
                <td><button class="del-btn" onclick="deleteRow(${l.id})">Delete</button></td>
            </tr>` + table.innerHTML;
        }
    });

    document.getElementById("walletDisp").textContent = currentWallet.toLocaleString();
    document.getElementById("cashDisp").textContent = currentCash.toLocaleString();
    document.getElementById("dailyDisp").textContent = dailyTubo.toLocaleString();
    document.getElementById("monthlyDisp").textContent = monthlyTubo.toLocaleString();
}

function downloadCSV() {
    if (logs.length === 0) return alert("No logs to download");
    let csv = "Date,Type,Ref,Name,Number,Amount,Fee\n";
    logs.forEach(l => { csv += `${l.date},${l.type},${l.ref},${l.note},${l.phone},${l.amount},${l.charge}\n`; });
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'GCash_Logbook.csv'; a.click();
}

function deleteRow(id) { if(confirm("Delete this record?")) { logs = logs.filter(l => l.id !== id); save(); } }

function saveInventory() {
    localStorage.setItem("initWallet", document.getElementById("startWallet").value);
    localStorage.setItem("initCash", document.getElementById("startCash").value);
    localStorage.setItem("initDaily", document.getElementById("startDaily").value);
    localStorage.setItem("initMonthly", document.getElementById("startMonthly").value);
    render();
    alert("Balances updated!");
}
function save() { localStorage.setItem("gcashLogs", JSON.stringify(logs)); render(); }
function logout() { sessionStorage.removeItem("isLoggedIn"); window.location.reload(); }

checkAuth();
</script>
</body>
</html>
