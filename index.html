<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GCash Agent Logbook Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">

<style>
:root { --primary: #007bff; --success: #28a745; --danger: #dc3545; --warning: #ffc107; --bg: #f4f6fa; --purple: #6f42c1; }
body { font-family: -apple-system, Arial, sans-serif; background: var(--bg); margin: 0; padding: 10px; }
h1 { text-align: center; color: var(--primary); margin: 10px 0; font-size: 20px; }
.container { max-width: 950px; margin: auto; background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
label { font-weight: bold; margin-top: 10px; display: block; font-size: 13px; }
input, select, button { width: 100%; padding: 12px; margin-top: 5px; border-radius: 8px; border: 1px solid #ccc; font-size: 14px; box-sizing: border-box; }
button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
.quick-btns { display: flex; gap: 5px; margin-top: 5px; }
.quick-btns button { background: #e9ecef; color: #444; font-size: 11px; padding: 8px; }
.dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 15px 0; }
.stat-box { background: #f8f9fa; padding: 10px; border-radius: 10px; text-align: center; border: 1px solid #eee; }
.stat-label { font-size: 9px; color: #666; display: block; text-transform: uppercase; margin-bottom: 2px; }
.stat-value { font-size: 15px; font-weight: bold; }
.wallet-val { color: var(--primary); }
.cash-val { color: var(--success); }
.tubo-val { color: var(--purple); }
.month-val { color: #fd7e14; }
.table-container { width: 100%; overflow-x: auto; margin-top: 10px; border-radius: 8px; border: 1px solid #eee; }
table { width: 100%; border-collapse: collapse; min-width: 550px; }
th, td { border-bottom: 1px solid #eee; padding: 10px 5px; font-size: 12px; text-align: center; }
th { background: #f1f3f6; }
.action-btn { padding: 5px 8px; font-size: 10px; width: auto; margin: 1px; border-radius: 4px; }
.delete { background: var(--danger); }
</style>
</head>
<body>

<h1>üìí GCash Logbook</h1>

<div id="mainApp" style="display:none;">
    <div class="container">
        <div class="dashboard" style="grid-template-columns: 1fr 1fr 1fr 1fr;">
            <div class="stat-box"><span class="stat-label">GCash Wallet</span><span class="stat-value wallet-val">‚Ç±<span id="walletDisp">0</span></span></div>
            <div class="stat-box"><span class="stat-label">Money on Hand</span><span class="stat-value cash-val">‚Ç±<span id="cashDisp">0</span></span></div>
            <div class="stat-box"><span class="stat-label">Today Tubo</span><span class="stat-value tubo-val">‚Ç±<span id="daily">0</span></span></div>
            <div class="stat-box"><span class="stat-label">Month Tubo</span><span class="stat-value month-val">‚Ç±<span id="monthly">0</span></span></div>
        </div>

        <label>Transaction Type</label>
        <select id="type"><option value="cashin">Cash In (Receive Cash)</option><option value="cashout">Cash Out (Give Cash)</option></select>

        <label>Customer GCash Number</label>
        <input type="text" id="phoneNumber" placeholder="09xx...">

        <label>Amount (‚Ç±)</label>
        <div class="quick-btns">
            <button type="button" onclick="setAmount(100)">+100</button>
            <button type="button" onclick="setAmount(500)">+500</button>
            <button type="button" onclick="setAmount(1000)">+1k</button>
        </div>
        <input type="number" id="amount" placeholder="0.00" oninput="autoCalculateTubo()">

        <label>Fee / Tubo (‚Ç±)</label>
        <input type="number" id="charge" placeholder="0.00">

        <button onclick="addTransaction()" style="margin-top: 15px; background: var(--primary);">Add Record</button>

        <div class="table-container">
            <table>
                <thead><tr><th>Date</th><th>Type</th><th>No.</th><th>Amt</th><th>Fee</th><th>Action</th></tr></thead>
                <tbody id="logTable"></tbody>
            </table>
        </div>

        <hr style="margin: 30px 0 10px 0; border:0; border-top:1px solid #eee;">
        <h3>‚öôÔ∏è Inventory Setup</h3>
        <label>Starting GCash Wallet Balance</label>
        <input type="number" id="startWallet">
        <label>Starting Cash on Hand</label>
        <input type="number" id="startCash">
        <button onclick="saveInventory()" style="background:#6c757d; margin-top:10px;">Update Starting Balances</button>
        <button onclick="logout()" style="background:#000; font-size:10px; margin-top:20px;">Lock App</button>
    </div>
</div>

<script>
/* SECURITY PIN */
function checkAuth() {
    let pin = localStorage.getItem("pin");
    let sessionAuth = sessionStorage.getItem("isLoggedIn");
    if (!pin || pin === "null") {
        let newPin = prompt("Set PIN:");
        if (newPin) { localStorage.setItem("pin", newPin); sessionStorage.setItem("isLoggedIn", "true"); showApp(); }
    } else if (sessionAuth === "true") { showApp(); }
    else {
        let enter = prompt("Enter PIN:");
        if (enter === pin) { sessionStorage.setItem("isLoggedIn", "true"); showApp(); }
        else { alert("Wrong"); window.location.reload(); }
    }
}
function showApp() { document.getElementById("mainApp").style.display = "block"; render(); }
function logout() { sessionStorage.removeItem("isLoggedIn"); window.location.reload(); }

/* APP LOGIC */
let logs = JSON.parse(localStorage.getItem("gcashLogs")) || [];
let initWallet = Number(localStorage.getItem("initWallet")) || 0;
let initCash = Number(localStorage.getItem("initCash")) || 0;

document.getElementById("startWallet").value = initWallet;
document.getElementById("startCash").value = initCash;

function setAmount(val) { document.getElementById("amount").value = val; autoCalculateTubo(); }

function autoCalculateTubo() {
    const amt = Number(document.getElementById("amount").value);
    const chargeInput = document.getElementById("charge");
    if (amt >= 2501) chargeInput.value = 35;
    else if (amt >= 1001) chargeInput.value = 25;
    else if (amt >= 501) chargeInput.value = 20;
    else if (amt >= 251) chargeInput.value = 15;
    else if (amt >= 1) chargeInput.value = 10;
}

function addTransaction() {
    const amt = Number(document.getElementById("amount").value);
    const charge = Number(document.getElementById("charge").value) || 0;
    if (amt <= 0) return alert("Enter amount");

    const now = new Date();
    logs.push({
        id: Date.now(),
        date: now.toLocaleString([], { month: 'short', day: 'numeric', hour: '2-digit', minute:'2-digit' }),
        day: now.toLocaleDateString(),
        month: now.getMonth() + "-" + now.getFullYear(),
        type: document.getElementById("type").value,
        phone: document.getElementById("phoneNumber").value || "N/A",
        amount: amt,
        charge: charge
    });
    save();
}

function render() {
    const table = document.getElementById("logTable");
    let currentWallet = initWallet;
    let currentCash = initCash;
    let daily = 0; let monthly = 0;
    const today = new Date().toLocaleDateString();
    const thisMonth = new Date().getMonth() + "-" + new Date().getFullYear();
    
    table.innerHTML = "";
    logs.forEach(l => {
        if (l.type === "cashin") {
            currentWallet -= l.amount;
            currentCash += (l.amount + l.charge);
        } else {
            currentWallet += (l.amount + l.charge);
            currentCash -= l.amount;
        }
        if (l.day === today) daily += l.charge;
        if (l.month === thisMonth) monthly += l.charge;
        
        table.innerHTML = `<tr><td>${l.date}</td><td>${l.type.toUpperCase()}</td><td>${l.phone}</td><td>‚Ç±${l.amount}</td><td>‚Ç±${l.charge}</td><td><button class="action-btn delete" onclick="deleteRow(${l.id})">Del</button></td></tr>` + table.innerHTML;
    });

    document.getElementById("walletDisp").textContent = currentWallet.toLocaleString();
    document.getElementById("cashDisp").textContent = currentCash.toLocaleString();
    document.getElementById("daily").textContent = daily.toLocaleString();
    document.getElementById("monthly").textContent = monthly.toLocaleString();
}

function deleteRow(id) { if(confirm("Delete?")) { logs = logs.filter(l => l.id !== id); save(); } }
function saveInventory() {
    localStorage.setItem("initWallet", document.getElementById("startWallet").value);
    localStorage.setItem("initCash", document.getElementById("startCash").value);
    location.reload();
}
function save() { localStorage.setItem("gcashLogs", JSON.stringify(logs)); render(); }
checkAuth();
</script>
</body>
</html>
