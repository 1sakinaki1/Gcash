<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GCash Agent Logbook Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
:root { 
    --primary: #007bff; --success: #28a745; --danger: #dc3545; --warning: #00c4ff; --bg: #f4f6fa; --card: #ffffff; --text: #333333; --border: #eeeeee; --input-bg: #ffffff;
}
body.dark { 
    --bg: #121212; --card: #1e1e1e; --text: #e0e0e0; --border: #333333; --input-bg: #2d2d2d;
}

body { font-family: -apple-system, Arial, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; transition: 0.3s; }
.container { max-width: 950px; margin: auto; background: var(--card); padding: 20px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); }

h1 { text-align: center; color: var(--primary); margin-bottom: 20px; font-size: 22px; }
.theme-toggle { background: none; color: var(--primary); border: 1px solid var(--primary); width: auto; padding: 8px 15px; font-size: 11px; border-radius: 20px; cursor: pointer; display: block; margin: 0 auto 15px auto; }

.dashboard { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
.stat-box { background: var(--bg); padding: 10px 5px; border-radius: 12px; text-align: center; border: 1px solid var(--border); }
.stat-label { font-size: 9px; opacity: 0.7; text-transform: uppercase; font-weight: bold; display: block; margin-bottom: 5px; }
.stat-edit { 
    background: transparent; border: none; color: inherit; font-size: 13px; font-weight: bold; 
    text-align: center; width: 90%; outline: none; padding: 2px; border-radius: 4px;
}
.stat-edit:focus { background: rgba(0,123,255,0.1); border-bottom: 1px solid var(--primary); }

label { font-weight: 600; margin-top: 15px; display: block; font-size: 13px; }
input, select, button { width: 100%; padding: 12px; margin-top: 6px; border-radius: 10px; border: 1px solid var(--border); font-size: 14px; box-sizing: border-box; background: var(--input-bg); color: var(--text); }
button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }

.page-nav { display: flex; align-items: center; justify-content: space-between; margin-top: 20px; gap: 5px; }
.nav-btn { background: var(--bg); color: var(--primary); border: 1px solid var(--primary); padding: 8px; font-size: 10px; width: auto; flex: 1; }
.today-btn { background: var(--primary); color: white; border: none; padding: 8px; font-size: 10px; width: auto; flex: 1; }
.current-date-display { font-weight: bold; font-size: 12px; text-align: center; flex: 1.5; color: var(--primary); }
.date-picker-input { padding: 4px; font-size: 11px; border-radius: 5px; border: 1px solid var(--border); width: 100%; }

.table-container { width: 100%; overflow-x: auto; margin-top: 10px; border-radius: 10px; border: 1px solid var(--border); }
table { width: 100%; border-collapse: collapse; min-width: 750px; }
th, td { border-bottom: 1px solid var(--border); padding: 12px 8px; font-size: 12px; text-align: center; }
th { background: var(--bg); color: var(--primary); }

.badge { padding: 4px 8px; border-radius: 6px; font-weight: bold; font-size: 10px; display: inline-block; }
.type-cashin { background: rgba(40, 167, 69, 0.2); color: #28a745; border: 1px solid #28a745; }
.type-cashout { background: rgba(220, 53, 69, 0.2); color: #dc3545; border: 1px solid #dc3545; }
.type-load { background: rgba(0, 196, 255, 0.2); color: #0096cc; border: 1px solid #00c4ff; }
.type-system { background: #6c757d; color: white; border: 1px solid #333; }

.del-btn { background: var(--danger); width: auto; padding: 6px 10px; font-size: 10px; }
</style>
</head>
<body>

<div id="mainApp" style="display:none;">
    <div class="container">
        <button class="theme-toggle" onclick="toggleTheme()">üåì Toggle Dark/White Mode</button>
        <h1>üìí GCash Logbook</h1>

        <div class="dashboard">
            <div class="stat-box">
                <span class="stat-label">GCash</span>
                <span style="color:var(--primary)">‚Ç±<input type="number" id="walletEdit" class="stat-edit" onchange="manualUpdate('Wallet', this.value)"></span>
            </div>
            <div class="stat-box">
                <span class="stat-label">On Hand</span>
                <span style="color:var(--success)">‚Ç±<input type="number" id="cashEdit" class="stat-edit" onchange="manualUpdate('Cash', this.value)"></span>
            </div>
            <div class="stat-box">
                <span class="stat-label">Today</span>
                <span style="color:#6f42c1">‚Ç±<input type="number" id="dailyEdit" class="stat-edit" onchange="manualUpdate('Daily', this.value)"></span>
            </div>
            <div class="stat-box">
                <span class="stat-label">Month</span>
                <span style="color:#fd7e14">‚Ç±<input type="number" id="monthlyEdit" class="stat-edit" onchange="manualUpdate('Monthly', this.value)"></span>
            </div>
        </div>

        <label>Transaction Type</label>
        <select id="type">
            <option value="" disabled selected>Select Type</option>
            <option value="cashin">Cash In</option>
            <option value="load">Load</option>
            <option value="cashout">Cash Out</option>
        </select>

        <label>Customer Name</label>
        <input type="text" id="note" placeholder="Enter Name">

        <label>GCash Number</label>
        <input type="text" id="phoneNumber" placeholder="09xxxxxxxxx">

        <label>Amount (‚Ç±)</label>
        <input type="number" id="amount" placeholder="0.00" oninput="autoCalculateTubo()">

        <label>Reference Number</label>
        <input type="text" id="refNum" placeholder="Enter Ref #">

        <label>Fee / Tubo (‚Ç±)</label>
        <input type="number" id="charge" placeholder="0.00">

        <button onclick="addTransaction()" style="margin-top: 20px; background: var(--primary); height: 50px;">Save Transaction</button>
        
        <div class="table-header-tools">
            <div class="page-nav">
                <button class="nav-btn" onclick="changeDay(-1)">‚Üê Older</button>
                <button class="today-btn" onclick="goToday()">Today</button>
                <div class="current-date-display">
                    <input type="date" id="dateJump" class="date-picker-input" onchange="jumpToDate()">
                </div>
                <button class="nav-btn" onclick="changeDay(1)">Newer ‚Üí</button>
            </div>
            <input type="text" id="search" placeholder="üîç Search name, number, or ref#..." oninput="render()" style="margin-top: 15px; width:100%; padding:10px; border-radius:10px; border:1px solid var(--border); background:var(--input-bg); color:var(--text);">
        </div>

        <div class="table-container">
            <table>
                <thead><tr><th>Time/Date</th><th>Type</th><th>Ref #</th><th>Name / Adjustment</th><th>Number</th><th>Amt</th><th>Fee</th><th>Action</th></tr></thead>
                <tbody id="logTable"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
let logs = JSON.parse(localStorage.getItem("gcashLogs")) || [];
let viewDate = new Date();

function checkAuth() {
    let pin = localStorage.getItem("pin");
    let sessionAuth = sessionStorage.getItem("isLoggedIn");
    if (!pin || pin === "null") {
        let newPin = prompt("Set PIN:");
        if (newPin) { localStorage.setItem("pin", newPin); sessionStorage.setItem("isLoggedIn", "true"); showApp(); }
    } else if (sessionAuth === "true") { showApp(); }
    else {
        let enter = prompt("Enter PIN:");
        if (enter === pin) { sessionStorage.setItem("isLoggedIn", "true"); showApp(); }
        else { alert("Wrong PIN"); window.location.reload(); }
    }
}

function showApp() { 
    if(localStorage.getItem("theme") === "dark") document.body.classList.add("dark");
    document.getElementById("mainApp").style.display = "block"; 
    updateDatePicker();
    render(); 
}

function manualUpdate(target, newVal) {
    const oldVal = Number(document.getElementById(target.toLowerCase() + "Edit").dataset.current || 0);
    const reason = prompt(`Adjusting ${target}. Reason?`, "Manual Correction");
    if (reason !== null) {
        const now = new Date();
        logs.push({
            id: Date.now(),
            fullDate: now.toISOString().split('T')[0],
            time: now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
            monthKey: now.getMonth() + "-" + now.getFullYear(),
            type: "system",
            ref: "ADJUST",
            phone: "---",
            note: `MODIFIED ${target.toUpperCase()}: (‚Ç±${oldVal} ‚Üí ‚Ç±${newVal})`,
            comment: reason,
            amount: 0,
            charge: 0,
            targetBox: target,
            newVal: Number(newVal)
        });
        save();
    } else { render(); }
}

function addTransaction() {
    const type = document.getElementById("type").value;
    const amt = Number(document.getElementById("amount").value);
    const charge = Number(document.getElementById("charge").value) || 0;
    if (!type || amt <= 0) return alert("Fill up Type and Amount");

    const now = new Date();
    logs.push({
        id: Date.now(),
        fullDate: now.toISOString().split('T')[0],
        time: now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
        monthKey: now.getMonth() + "-" + now.getFullYear(),
        type: type,
        ref: document.getElementById("refNum").value || "---",
        phone: document.getElementById("phoneNumber").value || "N/A",
        note: document.getElementById("note").value || "-",
        amount: amt,
        charge: charge
    });
    ["type","refNum","phoneNumber","note","amount","charge"].forEach(id => {
        const el = document.getElementById(id);
        if(el.tagName === "SELECT") el.selectedIndex = 0; else el.value = "";
    });
    save();
}

function render() {
    const table = document.getElementById("logTable");
    const query = document.getElementById("search").value.toLowerCase();
    const activeDayKey = viewDate.toISOString().split('T')[0];
    const todayKey = new Date().toISOString().split('T')[0];
    const thisMonthKey = new Date().getMonth() + "-" + new Date().getFullYear();

    let wallet = 0, cash = 0, dailyTubo = 0, monthlyTubo = 0;
    table.innerHTML = "";

    logs.forEach(l => {
        if (l.type === "system") {
            if (l.targetBox === "Wallet") wallet = l.newVal;
            if (l.targetBox === "Cash") cash = l.newVal;
            if (l.targetBox === "Daily" && l.fullDate === todayKey) dailyTubo = l.newVal;
            if (l.targetBox === "Monthly" && l.monthKey === thisMonthKey) monthlyTubo = l.newVal;
        } else {
            if (l.type === "cashin" || l.type === "load") { wallet -= l.amount; cash += (l.amount + l.charge); }
            else if (l.type === "cashout") { wallet += (l.amount + l.charge); cash -= l.amount; }
            if (l.fullDate === todayKey) dailyTubo += l.charge;
            if (l.monthKey === thisMonthKey) monthlyTubo += l.charge;
        }

        if (l.fullDate === activeDayKey || (query && (l.note.toLowerCase().includes(query) || l.phone.includes(query) || l.ref.toLowerCase().includes(query)))) {
            let typeClass = `type-${l.type}`;
            table.innerHTML = `<tr>
                <td>${l.time}<br><small>${l.fullDate}</small></td>
                <td><span class="badge ${typeClass}">${l.type.toUpperCase()}</span></td>
                <td>${l.ref}</td>
                <td><b>${l.note}</b>${l.comment ? '<br><small>('+l.comment+')</small>' : ''}</td>
                <td>${l.phone}</td>
                <td>‚Ç±${l.amount.toLocaleString()}</td>
                <td>‚Ç±${l.charge}</td>
                <td><button class="del-btn" onclick="deleteRow(${l.id})">Delete</button></td>
            </tr>` + table.innerHTML;
        }
    });

    const setVal = (id, val) => { const el = document.getElementById(id); if(el) { el.value = val; el.dataset.current = val; } };
    setVal("walletEdit", wallet); setVal("cashEdit", cash); setVal("dailyEdit", dailyTubo); setVal("monthlyEdit", monthlyTubo);
}

function save() { localStorage.setItem("gcashLogs", JSON.stringify(logs)); render(); }
function deleteRow(id) { if(confirm("Delete record?")) { logs = logs.filter(l => l.id !== id); save(); } }
function goToday() { viewDate = new Date(); updateDatePicker(); render(); }
function updateDatePicker() { const y = viewDate.getFullYear(), m = String(viewDate.getMonth() + 1).padStart(2, '0'), d = String(viewDate.getDate()).padStart(2, '0'); document.getElementById("dateJump").value = `${y}-${m}-${d}`; }
function changeDay(o) { viewDate.setDate(viewDate.getDate() + o); updateDatePicker(); render(); }
function jumpToDate() { viewDate = new Date(document.getElementById("dateJump").value); render(); }
function autoCalculateTubo() { const a = Number(document.getElementById("amount").value), c = document.getElementById("charge"); c.value = a>=2501?35 : a>=1001?25 : a>=501?20 : a>=251?15 : a>=1?10 : 0; }
function toggleTheme() { document.body.classList.toggle("dark"); localStorage.setItem("theme", document.body.classList.contains("dark")?"dark":"light"); }
checkAuth();
</script>
</body>
</html>
